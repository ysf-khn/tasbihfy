generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Account {
  id                    String    @id
  accountId             String
  providerId            String
  userId                String
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime
  accessToken           String?
  accessTokenExpiresAt  DateTime?
  idToken               String?
  refreshToken          String?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model DailyProgress {
  id           String   @id
  userId       String
  dhikrId      String
  date         DateTime @default(now()) @db.Date
  targetCount  Int
  currentCount Int      @default(0)
  completed    Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime
  dhikr        Dhikr    @relation(fields: [dhikrId], references: [id], onDelete: Cascade)
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, dhikrId, date])
  @@index([dhikrId])
  @@index([userId, date])
}

model Dhikr {
  id              String          @id
  userId          String
  name            String
  targetCount     Int
  isFavorite      Boolean         @default(false)
  createdAt       DateTime        @default(now())
  updatedAt       DateTime
  arabicText      String?
  transliteration String?
  dailyProgress   DailyProgress[]
  user            User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  sessions        DhikrSession[]

  @@index([userId])
  @@index([userId, isFavorite])
}

model DhikrSession {
  id           String    @id
  dhikrId      String
  userId       String
  currentCount Int       @default(0)
  completed    Boolean   @default(false)
  startedAt    DateTime  @default(now())
  completedAt  DateTime?
  updatedAt    DateTime
  dhikr        Dhikr     @relation(fields: [dhikrId], references: [id], onDelete: Cascade)
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([dhikrId])
  @@index([userId])
}

model PrayerLocation {
  id          String   @id
  userId      String   @unique
  name        String
  latitude    String
  longitude   String
  timezone    String?
  country     String?
  countryCode String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model PrayerTimeCache {
  id             String   @id
  locationQuery  String
  date           DateTime @db.Date
  fajr           String
  shurooq        String
  dhuhr          String
  asr            String
  maghrib        String
  isha           String
  qiblaDirection String?
  latitude       String?
  longitude      String?
  timezone       String?
  country        String?
  countryCode    String?
  temperature    String?
  pressure       String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime

  @@unique([locationQuery, date])
  @@index([date])
  @@index([locationQuery])
}

model ReminderPreferences {
  id               String    @id
  userId           String    @unique
  reminderEnabled  Boolean   @default(false)
  reminderTime     String    @default("09:00")
  timezone         String    @default("UTC")
  pushSubscription Json?
  lastReminderSent DateTime?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime
  user             User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Session {
  id        String   @id
  userId    String
  token     String   @unique
  expiresAt DateTime
  ipAddress String?
  userAgent String?
  createdAt DateTime @default(now())
  updatedAt DateTime
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model User {
  id                  String               @id
  name                String
  email               String               @unique
  emailVerified       Boolean              @default(false)
  image               String?
  createdAt           DateTime             @default(now())
  updatedAt           DateTime
  accounts            Account[]
  dailyProgress       DailyProgress[]
  dhikrs              Dhikr[]
  dhikrSessions       DhikrSession[]
  prayerLocation      PrayerLocation?
  reminderPreferences ReminderPreferences?
  sessions            Session[]
}

model verification {
  id         String   @id
  identifier String
  value      String   @unique
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime

  @@unique([identifier, value])
}
